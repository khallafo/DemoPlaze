package TestCases;

import Pages.SignupPage;
import org.testng.annotations.Test;
import com.github.javafaker.Faker;
import org.openqa.selenium.Alert;
import org.openqa.selenium.NoAlertPresentException;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;

import java.time.Duration;

public class SignupTest extends TestBase {
    SignupPage signupPage;

    private void handleAlert(String expectedMessage) {
        try {
            WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(5));
            wait.until(ExpectedConditions.alertIsPresent());

            Alert alert = driver.switchTo().alert();
            String alertMessage = alert.getText();
            System.out.println("Captured Alert: " + alertMessage);

            Assert.assertEquals(alertMessage, expectedMessage, "Alert message did not match!");
            alert.accept(); // Close the alert
        } catch (NoAlertPresentException e) {
            System.out.println("No alert appeared.");
            Assert.fail("Expected an alert but none appeared.");
        }
    }

    @Test
    public void testSignup() {
        signupPage = new SignupPage(driver);
        Faker faker = new Faker();
        String randomName = faker.name().fullName();
        String randomPassword = faker.internet().password();

        signupPage.signup(randomName, randomPassword);
        System.out.println("Signup successful with name: " + randomName);
    }

    @Test
    public void testSignupWithEmptyUsername() {
        signupPage = new SignupPage(driver);
        String randomPassword = new Faker().internet().password();

        signupPage.signup("", randomPassword);
        System.out.println("Signup attempted with empty username");

        // Handle expected alert
        handleAlert("Please fill out Username and Password.");
    }

    @Test
    public void testSignupWithEmptyPassword() {
        signupPage = new SignupPage(driver);
        String randomName = new Faker().name().fullName();

        signupPage.signup(randomName, "");
        System.out.println("Signup attempted with empty password");

        // Handle expected alert
        handleAlert("Please fill out Username and Password.");
    }

    @Test
    public void testSignupWithSpecialCharacters() {
        signupPage = new SignupPage(driver);
        String specialCharName = "!@#$%^&*()_+";
        String specialCharPassword = "!@#$%^&*()_+";

        signupPage.signup(specialCharName, specialCharPassword);
        System.out.println("Signup attempted with special characters in username and password");

        // Handle expected alert (if applicable)
        handleAlert("Invalid characters in Username or Password.");
    }

    @Test
    public void testSignupWithLongUsernameAndPassword() {
        signupPage = new SignupPage(driver);
        String longUsername = new Faker().lorem().characters(256);
        String longPassword = new Faker().lorem().characters(256);

        signupPage.signup(longUsername, longPassword);
        System.out.println("Signup attempted with long username and password");

        // Handle expected alert (if applicable)
        handleAlert("Username or Password too long.");
    }
}
